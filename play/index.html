<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>DogeMiner:CE</title>
    
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="../favicon_io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../favicon_io/favicon-16x16.png">
    <link rel="manifest" href="../favicon_io/site.webmanifest">
    
    <link rel="stylesheet" href="styles.css?v=35">
    <style>
        @font-face {
            font-family: 'DogeSans';
            src: url('dogesans/DogeSans-Normal.otf') format('opentype');
            font-weight: normal;
            font-style: normal;
        }
        @font-face {
            font-family: 'DogeSans';
            src: url('dogesans/DogeSans-Italic.otf') format('opentype');
            font-weight: normal;
            font-style: italic;
        }
        @font-face {
            font-family: 'DogeSans';
            src: url('dogesans/DogeSansVF.ttf') format('truetype');
            font-weight: 100 900;
            font-style: normal;
        }
    </style>
</head>
<body>
    <!-- Page Background (with ad spaces) -->
    <div id="page-background">
        <!-- Background Images -->
        <div id="background-container">
            <img src="backgrounds/bg1.jpg" alt="Background" id="background-image-1" class="background-image active">
            <img src="backgrounds/bg3.jpg" alt="Background" id="background-image-2" class="background-image">
            <img src="backgrounds/bg4.jpg" alt="Background" id="background-image-3" class="background-image">
            <img src="backgrounds/bg5.jpg" alt="Background" id="background-image-4" class="background-image">
            <img src="backgrounds/bg6.jpg" alt="Background" id="background-image-5" class="background-image">
            <img src="backgrounds/bg7.jpg" alt="Background" id="background-image-6" class="background-image">
            <img src="backgrounds/bg9.jpg" alt="Background" id="background-image-7" class="background-image">
            <img src="backgrounds/bg-new.jpg" alt="Background" id="background-image-8" class="background-image">
        </div>
    </div>

    <!-- Game Container (centered with margins for ads) -->
    <div id="game-container">
        <!-- Left Panel - Mining Area -->
        <div id="left-panel" class="game-panel">
                <!-- Platform (behind everything) -->
                <div id="platform-container">
                    <img src="../assets/quickUI/dogeplatform.png" alt="Platform" id="platform">
                </div>
                
                <!-- Mining Area -->
                <div id="mining-area">
                    <!-- Character with Shadow Circle -->
                    <div id="character-container">
                        <img src="assets/items/pickaxes/standard.png" alt="Pickaxe" id="pickaxe">
                        <img src="assets/general/character/standard.png" alt="Doge" id="main-character">
                        <div id="character-shadow"></div>
                    </div>
                    
                    <!-- Rock -->
                    <div id="rock-container">
                        <img src="assets/general/rocks/earth.png" alt="Rock" id="main-rock">
                        <div id="click-overlay"></div>
                    </div>

                    <!-- Particle Effects -->
                    <div id="particle-container"></div>

                    <!-- Floating Coins -->
                    <div id="floating-coins"></div>
                </div>

                <!-- Helper Container -->
                <div id="helper-container"></div>

            <!-- Stats Display -->
            <div id="stats-display">
                <div class="stat-item">
                    <img src="assets/general/dogecoin_70x70.png" alt="Dogecoin" class="stat-icon">
                    <span id="dogecoin-amount">0</span>
                </div>
                <div class="stat-item">
                    <img src="assets/general/persec_icon.png" alt="DPS" class="stat-icon">
                    <span id="dps-amount">0</span>
                </div>
            </div>
        </div>

        <!-- Version Indicator -->
        <div id="version-indicator">v0.03 (ALPHA)</div>

        <!-- Planet Tabs -->
        <div id="planet-tabs">
            <button class="planet-tab active" data-planet="earth" onclick="switchPlanet('earth')">
                <img src="assets/general/earth_tab.png" alt="Earth">
            </button>
            <button class="planet-tab" data-planet="moon" onclick="switchPlanet('moon')">
                <img src="assets/general/moon_tab.png" alt="Moon">
            </button>
            <button class="planet-tab" data-planet="mars" onclick="switchPlanet('mars')">
                <img src="assets/general/mars_tab.png" alt="Mars">
            </button>
            <button class="planet-tab" data-planet="jupiter" onclick="switchPlanet('jupiter')">
                <img src="assets/general/jupiter_tab.png" alt="Jupiter">
            </button>
            <button class="planet-tab" data-planet="titan" onclick="switchPlanet('titan')">
                <img src="assets/general/titan_tab.png" alt="Titan">
            </button>
        </div>

        <!-- Right Panel - UI -->
        <div id="right-panel" class="game-panel">
            <!-- Panel Tabs -->
            <div id="panel-tabs">
                <div class="tabs-left">
                    <button class="tab-btn active" onclick="switchMainTab('shop')">
                        <img src="assets/quickUI/Pickaxe.png" alt="Shop" class="tab-icon">
                        <span class="tab-text">SHOP</span>
                    </button>
                    <button class="tab-btn" onclick="switchMainTab('upgrades')">
                        <img src="assets/quickUI/ArrowUp.png" alt="Upgrades" class="tab-icon">
                        <span class="tab-text">UPGRADE</span>
                    </button>
                </div>
                    <div class="tabs-right">
                        <button class="tab-btn moon-tab" id="achievements-tab-btn" onclick="switchMainTab('achievements')">
                            <img src="assets/quickUI/Trophy ICON.png" alt="Achievements" class="tab-icon">
                        </button>
                        <button class="tab-btn moon-tab" id="settings-tab-btn" onclick="switchMainTab('settings')">
                            <img src="assets/quickUI/settings icon.png" alt="Settings" class="tab-icon">
                        </button>
                    </div>
            </div>

            <!-- Panel Content -->
            <div id="panel-content">
                <!-- Shop Tab -->
                <div id="shop-tab" class="tab-content active">
                    <div id="shop-content">
                        <!-- Shop content will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Upgrades Tab -->
                <div id="upgrades-tab" class="tab-content">
                    <div id="upgrades-container">
                        <!-- Section 1: Helper Upgrades -->
                        <div class="upgrade-section" id="helper-upgrades-1">
                            <div class="searchdog-container">
                                <img class="searchdog" src="assets/general/searchdog_1.png" alt="Searchdog" data-section="0">
                            </div>
                            <h3 class="section-title">Helper Upgrades</h3>
                            <div class="upgrades-grid">
                                <!-- Upgrades will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <!-- Section 2: Helper Upgrades -->
                        <div class="upgrade-section" id="helper-upgrades-2">
                            <div class="searchdog-container">
                                <img class="searchdog" src="assets/general/searchdog_1.png" alt="Searchdog" data-section="1">
                            </div>
                            <h3 class="section-title">Helper Upgrades</h3>
                            <div class="upgrades-grid">
                                <!-- Upgrades will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <!-- Section 3: Helper Upgrades -->
                        <div class="upgrade-section" id="helper-upgrades-3">
                            <div class="searchdog-container">
                                <img class="searchdog" src="assets/general/searchdog_1.png" alt="Searchdog" data-section="2">
                            </div>
                            <h3 class="section-title">Helper Upgrades</h3>
                            <div class="upgrades-grid">
                                <!-- Upgrades will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Achievements Tab -->
                <div id="achievements-tab" class="tab-content">
                    <div id="achievements-content">
                        <!-- Achievements content will be populated by JavaScript -->
                    </div>
                    
                    <div id="stats-content" class="achievements-sub-content">
                        <div class="stats-grid">
                            <div class="stat-row">
                                <span>Total Dogecoins Mined:</span>
                                <span id="total-mined">0</span>
                            </div>
                            <div class="stat-row">
                                <span>Total Clicks:</span>
                                <span id="total-clicks">0</span>
                            </div>
                            <div class="stat-row">
                                <span>Helpers Owned:</span>
                                <span id="helpers-owned">0</span>
                            </div>
                            <div class="stat-row">
                                <span>Current Level:</span>
                                <span id="current-level">Earth</span>
                            </div>
                            <div class="stat-row">
                                <span>Play Time:</span>
                                <span id="play-time">0s</span>
                            </div>
                            <div class="stat-row">
                                <span>Highest DPS:</span>
                                <span id="highest-dps">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div id="settings-tab" class="tab-content">
                    <div class="settings-grid">
                        <!-- Left Column - Actual Settings -->
                        <div class="settings-column">
                            <div class="settings-section">
                                <h3>Game Settings</h3>
                                <div class="setting-item">
                                    <label>
                                        <input type="checkbox" id="sound-enabled" checked>
                                        Sound Effects
                                    </label>
                                </div>
                                <div class="setting-item">
                                    <label>
                                        <input type="checkbox" id="music-enabled" checked>
                                        Background Music
                                    </label>
                                </div>
                                <div class="setting-item">
                                    <label>
                                        <input type="checkbox" id="notifications-enabled" checked>
                                        Notifications
                                    </label>
                                </div>
                                <div class="setting-item">
                                    <label>
                                        <input type="checkbox" id="auto-save-enabled" checked>
                                        Auto Save
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Right Column - Save Related Settings -->
                        <div class="settings-column">
                            <div class="settings-section">
                                <h3>Cloud Save</h3>
                                <div id="cloud-save-section">
                                    <div id="user-info" style="display: none;">
                                        <p id="user-name">Signed in as: </p>
                                        <div class="setting-buttons" id="cloud-save-buttons">
                                            <button class="setting-btn" onclick="saveToCloud()">Save to Cloud</button>
                                            <button class="setting-btn" onclick="loadFromCloud()">Load from Cloud</button>
                                            <button class="setting-btn" onclick="signOutUser()">Sign Out</button>
                                        </div>
                                        <div id="cloud-local-actions"></div>
                                    </div>
                                    <div id="sign-in-section">
                                        <button class="google-signin-btn" onclick="signInWithGoogle()">
                                            <svg class="google-icon" viewBox="0 0 24 24">
                                                <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                                <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                                <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                                <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                                            </svg>
                                            Sign in with Google
                                        </button>
                                        <p class="cloud-info">Sign in to save your progress in the cloud and access it from any device!</p>
                                    </div>
                                </div>
                            </div>
                            <div class="settings-section" id="local-save-section">
                                <h3>Local Save/Load</h3>
                                <div class="setting-buttons" id="local-save-buttons">
                                    <button class="setting-btn" onclick="saveGame()">Save Game</button>
                                    <button class="setting-btn" onclick="loadGame()">Load Game</button>
                                    <button class="setting-btn" onclick="exportSave()">Export Save</button>
                                    <button class="setting-btn" onclick="importSave()">Import Save</button>
                                    <button class="setting-btn danger" onclick="resetGame()">Reset Game</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Mobile Menu Toggle Button -->
    <button id="mobile-menu-toggle" class="mobile-only">
        <img src="assets/general/btn_up.png" alt="Toggle Menu" id="mobile-toggle-icon">
    </button>

    <!-- Mobile Planet Toggle & Menu -->
    <div id="mobile-planet-toggle" class="mobile-only">
        <img src="assets/general/earth.png" alt="Current Planet" id="mobile-current-planet-icon">
    </div>

    <div id="mobile-planet-menu" class="mobile-only">
        <div class="mobile-planet-menu-header">
            <span>Travel to...</span>
            <button id="close-planet-menu">Ã—</button>
        </div>
        <div class="mobile-planet-list">
            <button class="mobile-planet-tab active" data-planet="earth">
                <img src="assets/general/earth.png" alt="Earth">
                <span>Earth</span>
            </button>
            <button class="mobile-planet-tab" data-planet="moon" disabled>
                <img src="assets/general/moon.png" alt="Moon">
                <span>Moon</span>
                <div class="mobile-lock-overlay">LOCKED</div>
            </button>
            <button class="mobile-planet-tab" data-planet="mars" disabled>
                <img src="assets/general/mars.png" alt="Mars">
                <span>Mars</span>
                <div class="mobile-lock-overlay">LOCKED</div>
            </button>
            <button class="mobile-planet-tab" data-planet="jupiter" disabled>
                <img src="assets/general/jupiter.png" alt="Jupiter">
                <span>Jupiter</span>
                <div class="mobile-lock-overlay">LOCKED</div>
            </button>
            <button class="mobile-planet-tab" data-planet="titan" disabled>
                <img src="assets/general/titan.png" alt="Titan">
                <span>Titan</span>
                <div class="mobile-lock-overlay">LOCKED</div>
            </button>
        </div>
    </div>

    <!-- Mobile Bottom Menu -->
    <div id="mobile-bottom-menu" class="mobile-only">
        <!-- Mobile Panel Tabs -->
        <div id="mobile-panel-tabs">
            <div class="mobile-tabs-left">
                <button class="mobile-tab-btn active" data-tab="shop" onclick="switchMobileTab('shop')">
                    <img src="assets/quickUI/Pickaxe.png" alt="Shop" class="tab-icon">
                    <span class="tab-text">SHOP</span>
                </button>
                <button class="mobile-tab-btn" data-tab="upgrades" onclick="switchMobileTab('upgrades')">
                    <img src="assets/quickUI/ArrowUp.png" alt="Upgrades" class="tab-icon">
                    <span class="tab-text">UPGRADE</span>
                </button>
            </div>
            <div class="mobile-tabs-right">
                <button class="mobile-tab-btn" id="mobile-achievements-tab-btn" data-tab="achievements" onclick="switchMobileTab('achievements')">
                    <img src="assets/quickUI/Trophy ICON.png" alt="Achievements" class="tab-icon">
                </button>
                <button class="mobile-tab-btn" id="mobile-settings-tab-btn" data-tab="settings" onclick="switchMobileTab('settings')">
                    <img src="assets/quickUI/settings icon.png" alt="Settings" class="tab-icon">
                </button>
            </div>
        </div>

        <!-- Mobile Panel Content -->
        <div id="mobile-panel-content">
            <!-- Mobile Shop Tab -->
            <div id="mobile-shop-tab" class="mobile-tab-content active">
                <div id="mobile-shop-content" class="mobile-shop-scroll">
                    <!-- Shop content will be populated by JavaScript -->
                </div>
            </div>

            <!-- Mobile Upgrades Tab -->
            <div id="mobile-upgrades-tab" class="mobile-tab-content">
                <div id="mobile-upgrades-container">
                    <!-- Upgrades will be populated by JavaScript -->
                </div>
            </div>

            <!-- Mobile Achievements Tab -->
            <div id="mobile-achievements-tab" class="mobile-tab-content">
                <div id="mobile-achievements-content">
                    <!-- Achievements content will be populated by JavaScript -->
                </div>
            </div>

            <!-- Mobile Settings Tab -->
            <div id="mobile-settings-tab" class="mobile-tab-content">
                <div id="mobile-settings-content">
                    <!-- Settings content will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications -->
    <div id="notifications"></div>

    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loading-content">
            <!-- Loading logo uses encoded spaces so it resolves consistently across static servers -->
            <img src="assets/DogeMiner%20CE%20Logo.png" alt="DogeMiner CE" class="loading-logo">
            <div class="loading-title">INITIALIZING</div>
            <img src="assets/quickUI/dogeloader.svg" alt="Loading" class="loading-spinner">
            <div class="loading-info" id="loading-info">Loading DogeMiner: Community Edition...</div>
        </div>
    </div>

    <!-- Cutscene Overlay -->
    <div id="cutscene-overlay" class="cutscene-overlay">
        <video id="cutscene-video" class="cutscene-video" playsinline></video>
        <button id="cutscene-skip" class="cutscene-skip hidden">SKIP</button>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-analytics.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA6fW_scDVgPVkQCosrV13ye1egRDOlfd4",
            authDomain: "dogeminer-community-edition.firebaseapp.com",
            projectId: "dogeminer-community-edition",
            storageBucket: "dogeminer-community-edition.firebasestorage.app",
            messagingSenderId: "551478867465",
            appId: "1:551478867465:web:11a3351d7b913bac136ad8",
            measurementId: "G-VWD4HSGLNK"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const analytics = getAnalytics(app);
        const provider = new GoogleAuthProvider();

        // Make Firebase available globally
        window.firebase = {
            auth,
            db,
            provider,
            signInWithPopup,
            signOut,
            onAuthStateChanged,
            doc,
            setDoc,
            getDoc,
            collection
        };

        console.log("Firebase initialized successfully!");
    </script>

    <!-- Scripts -->
    <script>
        (function () {
            // Local fallbacks keep audio/animation responsive when CDNs are blocked.
            function attachGsapLite() {
                if (window.gsap) {
                    return;
                }

                function scheduleCompletion(callback, durationSeconds) {
                    if (typeof callback === 'function') {
                        setTimeout(() => {
                            try {
                                callback();
                            } catch (error) {
                                console.warn('GSAP fallback completion callback failed', error);
                            }
                        }, Math.max(0, durationSeconds * 1000 || 0));
                    }
                }

                function TimelineLite() {}

                TimelineLite.prototype.to = function timelineTo(targets, vars = {}) {
                    scheduleCompletion(vars.onComplete, vars.duration);
                    return this;
                };

                window.gsap = {
                    timeline() {
                        return new TimelineLite();
                    },
                    to(targets, vars = {}) {
                        scheduleCompletion(vars.onComplete, vars.duration);
                        return targets;
                    }
                };
            }

            function attachHowlerLite() {
                if (window.Howl) {
                    return;
                }

                window.Howler = {
                    volume: () => 1,
                    mute: () => {},
                    stop: () => {},
                    ctx: null
                };

                window.Howl = function HowlLite(options = {}) {
                    const settings = { ...options };
                    let isPlaying = false;
                    let storedVolume = typeof settings.volume === 'number' ? settings.volume : 1;
                    let storedLoop = !!settings.loop;

                    const play = () => {
                        isPlaying = true;
                        if (typeof settings.onplay === 'function') {
                            try {
                                settings.onplay();
                            } catch (error) {
                                console.warn('Howler fallback onplay handler failed', error);
                            }
                        }

                        if (!storedLoop && typeof settings.onend === 'function') {
                            setTimeout(() => {
                                isPlaying = false;
                                try {
                                    settings.onend();
                                } catch (error) {
                                    console.warn('Howler fallback onend handler failed', error);
                                }
                            }, 0);
                        }

                        return Math.random().toString(36).slice(2);
                    };

                    const api = {
                        play,
                        stop() {
                            isPlaying = false;
                            return api;
                        },
                        pause() {
                            isPlaying = false;
                            return api;
                        },
                        playing() {
                            return isPlaying;
                        },
                        volume(level) {
                            if (typeof level === 'number') {
                                storedVolume = level;
                                return api;
                            }
                            return storedVolume;
                        },
                        loop(enable) {
                            if (typeof enable === 'boolean') {
                                storedLoop = enable;
                                return api;
                            }
                            return storedLoop;
                        },
                        fade() { return api; },
                        rate() { return 1; },
                        unload() { return undefined; },
                        on() { return api; },
                        once() { return api; },
                        off() { return api; },
                        seek() { return isPlaying ? 0 : NaN; }
                    };

                    return api;
                };
            }

            const queuedLibraries = [
                {
                    global: 'gsap',
                    name: 'GSAP',
                    sources: [
                        'https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js',
                        'https://cdn.jsdelivr.net/npm/gsap@3.12.2/dist/gsap.min.js'
                    ],
                    fallback: attachGsapLite
                },
                {
                    global: 'Howl',
                    name: 'Howler.js',
                    sources: [
                        'https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js',
                        'https://cdn.jsdelivr.net/npm/howler@2.2.4/dist/howler.min.js'
                    ],
                    fallback: attachHowlerLite
                }
            ];

            const gameScripts = [
                'js/audio.js',
                'js/game.js?v=35',
                'js/ui.js',
                'js/shop.js',
                'js/save.js',
                'js/notifications.js',
                'js/cloud-save.js',
                'js/main.js'
            ];

            function appendScript(src) {
                // Keep execution order stable while reporting any script fetch issues for debugging.
                return new Promise((resolve, reject) => {
                    const node = document.createElement('script');
                    node.src = src;
                    node.async = false; // preserve execution order
                    node.onload = () => resolve(src);
                    node.onerror = () => reject(new Error(`Failed to load script: ${src}`));
                    document.head.appendChild(node);
                });
            }

            async function loadWithFallback({ global, name, sources, fallback }) {
                if (typeof window[global] !== 'undefined') {
                    return;
                }

                for (const source of sources) {
                    try {
                        await appendScript(source);
                        if (typeof window[global] !== 'undefined') {
                            return;
                        }
                    } catch (error) {
                        console.warn(`${name} CDN failed`, error);
                    }
                }

                if (typeof window[global] === 'undefined' && typeof fallback === 'function') {
                    fallback();
                }

                console.error(`All sources failed. ${name} features may be unavailable.`);
            }

            (async function bootstrap() {
                for (const entry of queuedLibraries) {
                    await loadWithFallback(entry);
                }

                for (const script of gameScripts) {
                    try {
                        await appendScript(script);
                    } catch (error) {
                        console.error(error.message);
                    }
                }
            })();
        })();
    </script>
</body>
</html>
